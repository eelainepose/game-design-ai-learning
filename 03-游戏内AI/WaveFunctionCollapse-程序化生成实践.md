"# WaveFunctionCollapse 程序化生成实践 > 来自 mxgmn/WaveFunctionCollapse --- ## 核心原理 Wave Function Collapse (WFC) 是一种基于约束求解的程序化生成算法，灵感来自量子力学中的波函数坍缩。 ### 基本流程 1. **输入**：一个示例图案（位图或瓦片图） 2. **分析**：提取示例中的局部模式及其邻接规则 3. **生成**：在目标区域中放置瓦片，遵循邻接约束 4. **传播**：当一个瓦片确定后，传播约束给相邻位置 ### 关键概念 - **波函数**：每个位置可能的瓦片集合 - **坍缩**：选择一个瓦片确定该位置状态 - **传播**：约束传播，减少相邻位置的可能性 - **回溯**：遇到矛盾时回退到之前的状态 --- ## 游戏应用场景 ### 1. 地图生成 ``` 输入：一张手工设计的地图片段 输出：无限延伸的随机地图 保持：道路连接性、区域一致性 ``` ### 2. 纹理合成 ``` 输入：一小块草地纹理 输出：大面积无缝草地 保持：纹理的视觉连续性 ``` ### 3. 关卡设计 ``` 输入：一个房间布局示例 输出：随机地牢关卡 保持：房间连通性、可达性 ``` --- ## 实践案例：Roguelike 地牢生成 ### 步骤 1. **设计示例地图**（在 Tiled 中制作） 2. **导出瓦片数据** 3. **运行 WFC 算法** 4. **后处理**：添加起点、终点、敌人位置 ### 代码片段 ```python # 伪代码 from wfc import WaveFunctionCollapse # 加载示例 sample = load_tilemap("sample_dungeon.txt") # 创建生成器 wfc = WaveFunctionCollapse(sample) # 生成 20x20 的地图 dungeon = wfc.generate(width=20, height=20) # 保存 save_tilemap(dungeon, "generated_dungeon.txt") ``` --- ## 优缺点分析 ### 优点 - ✅ 生成的内容与示例风格一致 - ✅ 保持局部结构合理性 - ✅ 可控制生成参数 ### 缺点 - ❌ 可能出现无解情况（需要回溯） - ❌ 大规模生成性能开销 - ❌ 难以保证全局约束（如连通性） --- ## 相关工具 - **Tiled**：制作示例地图 - **WaveFunctionCollapse (C#)**：官方实现 - **bad-boy-fork (Python)**：Python 版本 --- *待补充实际生成案例和截图...* "